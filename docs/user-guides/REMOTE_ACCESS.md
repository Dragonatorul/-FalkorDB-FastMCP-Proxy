# FalkorDB FastMCP Proxy - Remote Access Guide

## Overview

This FastMCP proxy enables **remote access** to FalkorDB from Claude Desktop and other MCP clients using **Server-Sent Events (SSE)** transport with **OAuth 2.1 Bearer token authentication**.

## Architecture

```
Claude Desktop ‚ÜêSSE/HTTP‚Üí FastMCP Proxy ‚ÜêHTTP‚Üí FalkorDB MCPServer v1.1.0 ‚Üê‚Üí FalkorDB
    (Remote)              (Port 3001)            (Port 3000)              (Port 6379)
```

## Features Implemented

### ‚úÖ Remote MCP Server
- **SSE Transport**: Server-Sent Events for real-time remote connections
- **Bearer Token Authentication**: OAuth 2.1 compliant with JWT validation
- **Authorization Server Metadata**: RFC8414 compliant discovery at `/.well-known/oauth-authorization-server`
- **Dynamic Client Registration**: Ready for production OAuth flows

### ‚úÖ OAuth 2.1 Compliance
- **Authorization Endpoint**: `/authorize`
- **Token Endpoint**: `/token` 
- **Registration Endpoint**: `/register`
- **PKCE Support**: S256 code challenge method
- **Grant Types**: authorization_code, refresh_token

### ‚úÖ Production-Ready Backend Integration
- **FalkorDB MCPServer v1.1.0**: Production backend with multi-tenant support
- **API Translation**: FastMCP tools ‚Üí REST API calls
- **Error Handling**: Comprehensive error mapping
- **Health Checks**: Backend connectivity monitoring

## Quick Start

### 1. Start the Stack

```bash
# Start all services
docker-compose up -d

# Check services are running
docker-compose ps
```

### 2. Get Bearer Token

```bash
# Generate development token
python src/fastmcp_proxy.py

# Copy the Bearer token from output
```

### 3. Configure Claude Desktop

Add to Claude Desktop MCP settings:

```json
{
  "name": "FalkorDB",
  "serverUrl": "http://localhost:3001/sse/",
  "auth": {
    "type": "bearer",
    "token": "YOUR_BEARER_TOKEN_HERE"
  }
}
```

### 4. Test Connection

```bash
# Run comprehensive test
python tests/test_remote_mcp.py
```

## Available Tools

The proxy exposes 4 MCP tools that translate to FalkorDB MCPServer REST API:

| Tool | Description | Backend Endpoint |
|------|-------------|-----------------|
| `falkordb_query` | Execute Cypher queries | `POST /api/mcp/context` |
| `falkordb_list_graphs` | List available graphs | `GET /api/mcp/graphs` |
| `falkordb_server_info` | Get server metadata | `GET /api/mcp/metadata` |
| `falkordb_health` | Check server health | `GET /health` |

## OAuth Endpoints

The FastMCP proxy provides standard OAuth 2.1 endpoints:

| Endpoint | Purpose |
|----------|---------|
| `/.well-known/oauth-authorization-server` | Authorization server metadata discovery |
| `/authorize` | OAuth authorization endpoint |
| `/token` | Token exchange endpoint |
| `/register` | Dynamic client registration |
| `/sse/` | SSE connection endpoint (requires Bearer token) |

## Environment Variables

| Variable | Default | Description |
|----------|---------|-------------|
| `FALKORDB_MCPSERVER_URL` | `http://localhost:3000` | Backend FalkorDB MCPServer URL |
| `MCP_API_KEY` | `dev-api-key` | API key for backend authentication |
| `PROXY_HOST` | `0.0.0.0` | FastMCP proxy host |
| `PROXY_PORT` | `3001` | FastMCP proxy port |

## Remote Access Setup

### For Production Deployment

1. **Configure DNS**: Point domain to your server
2. **Setup HTTPS**: Use reverse proxy (nginx/Cloudflare) with SSL
3. **Generate Production Keys**: Replace development RSA keys
4. **Configure OAuth Provider**: Set up proper JWKS/OAuth server

### For Local Development

1. **Use development token** generated by the server
2. **Configure localhost**: Use `http://localhost:3001/sse/`
3. **Test with curl**:
   ```bash
   curl -H "Authorization: Bearer YOUR_TOKEN" http://localhost:3001/sse/
   ```

## Security Features

- **Bearer Token Validation**: RSA256 JWT signature verification
- **Issuer Validation**: Configurable issuer claim checking
- **Audience Validation**: Configurable audience claim checking
- **Scope Support**: Read/write scopes for authorization
- **Token Expiration**: Configurable token lifetime

## Testing

Run the test suite to validate the setup:

```bash
# Comprehensive test
python tests/test_remote_mcp.py

# Expected output:
# ‚úÖ Backend health: healthy
# ‚úÖ OAuth Authorization Server Metadata endpoint working
# ‚úÖ SSE endpoint accepts valid Bearer token
# üéâ All tests passed!
```

## Troubleshooting

### Bearer Token Issues
- **401 Unauthorized**: Check token expiration and signature
- **Invalid issuer**: Verify issuer claim matches configuration
- **Missing scopes**: Ensure token has required scopes

### Connection Issues  
- **Backend unavailable**: Check docker-compose services
- **Port conflicts**: Verify ports 3000, 3001, 6379 are available
- **Network issues**: Check Docker network connectivity

### Claude Desktop Issues
- **Connection timeout**: Verify SSE endpoint accessibility
- **Authentication failed**: Validate Bearer token format
- **Tool errors**: Check backend FalkorDB MCPServer logs

## Implementation Status

| Feature | Status | Notes |
|---------|--------|-------|
| SSE Transport | ‚úÖ Complete | FastMCP 2.10.2 with SSE support |
| Bearer Auth | ‚úÖ Complete | OAuth 2.1 with RSA256 JWT |
| OAuth Metadata | ‚úÖ Complete | RFC8414 compliant |
| MCP Tools | ‚úÖ Complete | 4 tools mapping to backend API |
| Docker Stack | ‚úÖ Complete | Ready for remote deployment |
| Production Keys | ‚ö†Ô∏è Development | Generate production RSA keys |
| HTTPS Support | ‚ö†Ô∏è Manual | Setup reverse proxy |

## Next Steps

1. **Deploy to production server** with proper domain/HTTPS
2. **Configure production OAuth provider** (Auth0, custom)
3. **Setup monitoring** for production deployment
4. **Scale backend** if needed for high load

---

üéØ **Goal Achieved**: FastMCP proxy successfully provides remote SSE access to FalkorDB with OAuth 2.1 authentication, ready for Claude Desktop integration.